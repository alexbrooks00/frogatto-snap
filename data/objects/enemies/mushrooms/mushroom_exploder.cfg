{
id: "mushroom_exploder",
prototype: ["ant"],
editor_info: {
	category: "enemies, forest",
},

properties: {
	taxonomy: "TaxonomyType :: enum mushroom",
	
	title: "~Explosive Fungus~",
	description: "~This mushroom is not only walking but also very explosive. Make sure not to set it on fire if you don't want it to explode.~",
	taste: "~Gunpowder.~",

	counter_value: "4+1d2",
	
	
	swallowable: "false",
	
	my_particles: {
		type: "obj legacy_particle_attache",
		init: "object('legacy_particle_attache',
		mid_x, mid_y, {
			_particle_type: 'fuse_sparks',
			parent: me,
			time_to_die: 50,
			custom_relative_pos_default: {mid_x: -10, mid_y: -10}
		})",
	},
	
#------------------------ behavior ------------------------#	

	explosion_timer: { type: "int", default: 30 },
	is_on_fire: { type: "bool", default: false },
	wont_turn_around_distance: { type: "int", default: 300 },

	explode: "def() -> commands [
		set(explosion_timer, explosion_timer - 1),
		if(explosion_timer = 399, [ 
						add_object(my_particles),
						sound('fuse-long.ogg')
					   ]),
								 
		if(explosion_timer < 0, die())
	]",
	
	
	handle_special_damage_response: "def(DamageType damage_type, int final_damage_amount, bool will_die) -> commands [
		if(damage_type = enum fire, set(is_on_fire, true))
	]",
		
	should_turn_away_from_cliff: "(turns_at_cliffs and 
		(not is_there_flat_ground_ahead_of_us(distance_to_cliff_check)) and
		(not standable(level, front + facing*96, y + wont_turn_around_distance)))",




#-------------------------- vars --------------------------#
	
},

hitpoints: 200,


on_process: "[
		if(is_on_fire = true, explode()),
	     ]",

on_die:  "[
	if(is_on_fire = true, [
		spawn('explosion_big_harmful',midpoint_x,midpoint_y-16,facing),
		stop_sound('fuse-long.ogg'),
		sound('BombExplode.wav'),	
	])
]",

animation: [

	{
		"@base": true,
		image: "enemies/mushroom-shooter-red.png",
		pad: 3,
		accel_x: 0,
		accel_y: 80,
		body_area: "all",
		attack_area: [6,17,26,35],
	},
	{
		id: "stand",
		rect: [1,84,31,120],
		frames: 1,
		duration: 6,
	},
	{
		id: "hurt",
		rect: [137,1,167,37],
		frames: 1,
		duration: 15,
	},
	{
		id: "turn",
		rect: [69,124,99,160],
		frames: 5,
		duration: 4,
	},
	{
		id: "spring",
		rect: [1,84,31,120],
		frames: 1,
		duration: 6,
	},
	{
		id: "walk",
		rect: [1,1,31,37],
		frames: 8,
		frames_per_row: 4,
		accel_x: 220,
		duration: 5,
	},
	{
		id: "attack_chargeup",
		rect: [1,84,31,120],
		frames: 7,
		duration: 5,
	},
	{
		id: "attack",
		rect: [1,124,31,160],
		frames: 2,
		duration: 5,
	},
	{
		id: "attack_recover",
		rect: [1,84,31,120],
		play_backwards: true,
		frames: 7,
		duration: 5,
	},
],
}
